const els={siteId:document.getElementById('siteId'),seed:document.getElementById('seed'),expandBtn:document.getElementById('expandBtn'),kwBody:document.getElementById('kwBody')};let allKeywords=[];
els.expandBtn.addEventListener('click',()=>expandKeywords());
async function expandKeywords(){const site_id=els.siteId.value.trim();const seed=els.seed.value.trim();if(!site_id||!seed){alert('Need site_id + seed');return;}
log('Expanding seed',{site_id,seed});const r=await fetch('/api/keywords',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({site_id,seed})});const data=await r.json().catch(()=>({}));if(!r.ok){alert(data.error||'Expand failed');log('Expand failed',data);return;}allKeywords=data.keywords||[];renderTable();}
function renderTable(){if(!allKeywords.length){els.kwBody.innerHTML='<tr><td colspan=3>No keywords</td></tr>';return;}els.kwBody.innerHTML=allKeywords.map(k=>rowHtml(k)).join('');}
function rowHtml(k){const badgeClass=`badge-src badge-${k.source||'unknown'}`;const score=scoreKeyword(k.keyword,k.source);return `<tr><td>${escapeHtml(k.keyword)}</td><td><span class="${badgeClass}">${k.source}</span></td><td>${score}</td></tr>`;}
function scoreKeyword(keyword,source){let score=0;const kw=keyword.toLowerCase();if(['google','youtube','reddit'].includes(source))score+=3;if(['modifier','paa_try','related_try'].includes(source))score+=2;if(source==='fallback')score+=1;if(/best|cheap|review|software|guide|2025/.test(kw))score+=2;const flames=Math.min(5,Math.max(1,Math.round(score/2)));return 'ðŸ”¥'.repeat(flames);}
function escapeHtml(s){return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}
